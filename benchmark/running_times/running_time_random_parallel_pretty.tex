%% SQL
%% drop view if exists p CASCADE;
%% create view p as
%% select * from pradixalgoswithips4oml
%% union
%% select * from pcomparisonalgos

%% SQL
%% drop view if exists palgos1 CASCADE;
%% create view palgos1 as
%% select avgparallel.* from avgparallel inner join p
%% on avgparallel.algo = p.algo

%% SQL
%% drop view if exists palgos2 CASCADE;
%% create view palgos2 as
%% select * from palgos1 natural join pfast

%% SQL
%% drop view if exists palgos CASCADE;
%% create view palgos as
%% select machine, gen, datatype, algo, parallel, threads, vector, size, meminterleaved, copyback, milli
%% from palgos2
%% where gen like 'random'

%% SQL
%% drop view if exists pavg CASCADE;
%% create view pavg as
%% select machine, threads, algo, size, datatype, AVG(milli) as milli
%% from palgos
%% group by machine, threads, algo, size, datatype

%% SQL
%% drop view if exists pavgnames CASCADE;
%% create view pavgnames as
%% select pavg.*, titles.title, titles.titleorder from pavg
%% inner join titles
%% on titles.algo like pavg.algo

\begin{figure}[htb]
  \begin{tikzpicture}
    \begin{groupplot}[
      group style={
        group size=2 by 2,
        vertical sep=1.2cm,
      },
      width=0.5\textwidth,
      height=0.25\textheight,
      xmode=log,
      log base x=2,
      legend columns = 4,
      plotstyleparallel,
      xmajorgrids=true,
      ymajorgrids=true,
      ymin=0,
      ytick={0, 0.25, 0.5, 0.75, 1,0, 1.25},
      ymax=1.3,
      xmin=2^16,
      xmax=2^34,
      restrict y to domain=-1:30,
      clip mode=individual,
      ]
      
      \nextgroupplot[
      title=\pcintellargefour]
    %% MULTIPLOT(algo|ptitle) select title as ptitle, size as x, 1000000.0 * milli * threads / (8 * size * log(2, size)) as y, MULTIPLOT
    %% from pavgnames
    %% where machine like 'i10pc135' and datatype like 'uint64' and size >= 2^13
    %% and algo not like 'ps4oparallel' and algo not like 'tbbparallelsort' and algo not like 'gnuparallel'
    %% order by titleorder, x
    \addplot+[on layer=foreground, mark layer=foreground] coordinates { (8192,100.558) (16384,82.862) (32768,89.8879) (65536,77.8785) (131072,69.5082) (262144,272.842) (524288,91.485) (1048576,51.7348) (2097152,16.214) (4194304,8.19541) (8388608,4.83204) (16777216,3.0039) (33554432,1.48097) (67108864,1.05922) (1.34218e+08,0.796086) (2.68435e+08,0.65567) (5.36871e+08,0.542512) (1.07374e+09,0.497786) (2.14748e+09,0.491777) (4.29497e+09,0.494022) (8.58993e+09,0.48621) (1.71799e+10,0.48513) };
    \addlegendentry{\compiparassssort};
    \addplot coordinates { (8192,259.368) (16384,213.431) (32768,73.9721) (65536,39.6091) (131072,18.9583) (262144,10.1523) (524288,6.53583) (1048576,4.61542) (2097152,3.49755) (4194304,2.86033) (8388608,2.13747) (16777216,1.70481) (33554432,1.52131) (67108864,1.38695) (1.34218e+08,1.21648) (2.68435e+08,1.10231) (5.36871e+08,1.18071) (1.07374e+09,1.12517) (2.14748e+09,1.20696) (4.29497e+09,1.12074) (8.58993e+09,1.20108) (1.71799e+10,1.12964) };
    \addlegendentry{\compppbbs};
    \addplot coordinates { (8192,5548.01) (16384,2609.65) (32768,1226.88) (65536,565.731) (131072,292.886) (262144,229) (524288,660.58) (1048576,352.109) (2097152,155.595) (4194304,63.9368) (8388608,31.2002) (16777216,15.7925) (33554432,8.27793) (67108864,4.57803) (1.34218e+08,3.02442) (2.68435e+08,2.25418) (5.36871e+08,1.93896) (1.07374e+09,1.9094) (2.14748e+09,1.93468) (4.29497e+09,1.85803) (8.58993e+09,1.65682) (1.71799e+10,1.82224) };
    \addlegendentry{\comppbalancedsort};
    \addplot coordinates { (8192,230.035) (16384,165.264) (32768,69.5297) (65536,32.6178) (131072,17.6271) (262144,13.963) (524288,6.29661) (1048576,4.03188) (2097152,2.43939) (4194304,2.07587) (8388608,1.71851) (16777216,0.959681) (33554432,0.794795) (67108864,0.915652) (1.34218e+08,0.70411) (2.68435e+08,0.620966) (5.36871e+08,0.624313) (1.07374e+09,0.885172) (2.14748e+09,0.605714) (4.29497e+09,0.700743) (8.58993e+09,0.681866) (1.71799e+10,0.790631) };
    \addlegendentry{\radixppbbr};
    \addplot coordinates { (8192,31146.4) (16384,14711.6) (32768,6726.5) (65536,3213.13) (131072,1495.08) (262144,721.121) (524288,333.272) (1048576,146.75) (2097152,72.6527) (4194304,37.1353) (8388608,17.9602) (16777216,9.28852) (33554432,5.15784) (67108864,3.09346) (1.34218e+08,2.19399) (2.68435e+08,1.86665) (5.36871e+08,1.52808) (1.07374e+09,1.24708) (2.14748e+09,1.20945) (4.29497e+09,1.30143) (8.58993e+09,1.27861) (1.71799e+10,1.0915) };
    \addlegendentry{\radixraduls};
    \addplot coordinates { (8192,581.348) (16384,531.872) (32768,2025.49) (65536,1153.41) (131072,625.82) (262144,314.641) (524288,143.951) (1048576,65.0585) (2097152,30.9133) (4194304,15.7186) (8388608,7.98326) (16777216,4.2173) (33554432,3.04761) (67108864,2.24534) (1.34218e+08,1.77937) (2.68435e+08,1.55028) (5.36871e+08,1.5233) (1.07374e+09,1.45049) (2.14748e+09,1.29741) (4.29497e+09,1.22226) (8.58993e+09,1.24997) (1.71799e+10,1.2341) };
    \addlegendentry{\radixregion};
    \addplot+[on layer=foreground, mark layer=foreground] coordinates { (8192,67.5722) (16384,65.2664) (32768,73.3991) (65536,66.99) (131072,49.8963) (262144,237.906) (524288,69.3588) (1048576,37.1239) (2097152,17.6535) (4194304,10.5414) (8388608,8.41928) (16777216,2.55519) (33554432,1.33667) (67108864,0.929411) (1.34218e+08,0.667885) (2.68435e+08,0.536817) (5.36871e+08,0.484496) (1.07374e+09,0.453198) (2.14748e+09,0.469834) (4.29497e+09,0.453161) (8.58993e+09,0.407985) (1.71799e+10,0.400633) };
    \addlegendentry{\compiparassrsort};

      \legend{}
      
    % (Relative) Coordinate at top of the first plot
    \coordinate (c1) at (rel axis cs:0,1);
      
      \nextgroupplot[
      title=\pcamd]
    %% MULTIPLOT(algo|ptitle) select title as ptitle, size as x, 1000000.0 * milli * threads / (8 * size * log(2, size)) as y, MULTIPLOT
    %% from pavgnames
    %% where machine like 'i10pc133' and datatype like 'uint64' and size >= 2^13
    %% and algo not like 'ps4oparallel' and algo not like 'tbbparallelsort' and algo not like 'gnuparallel'
    %% order by titleorder, x
    \addplot+[on layer=foreground, mark layer=foreground] coordinates { (8192,9.21107) (16384,10.6523) (32768,20.6204) (65536,14.3884) (131072,7.31475) (262144,2.53885) (524288,1.90118) (1048576,1.10824) (2097152,0.750215) (4194304,0.623472) (8388608,0.455158) (16777216,0.46659) (33554432,0.41079) (67108864,0.405667) (1.34218e+08,0.442744) (2.68435e+08,0.467612) (5.36871e+08,0.462489) (1.07374e+09,0.442474) (2.14748e+09,0.434272) (4.29497e+09,0.424741) };
    \addlegendentry{\compiparassssort};
    \addplot coordinates { (8192,7.89384) (16384,5.1107) (32768,3.75834) (65536,2.54592) (131072,1.98698) (262144,1.53511) (524288,1.19784) (1048576,0.887348) (2097152,0.793307) (4194304,0.769014) (8388608,0.832217) (16777216,0.743671) (33554432,0.72027) (67108864,0.688831) (1.34218e+08,0.690336) (2.68435e+08,0.664181) (5.36871e+08,0.662487) (1.07374e+09,0.644752) (2.14748e+09,0.648489) };
    \addlegendentry{\compppbbs};
    \addplot coordinates { (8192,269.7) (16384,168.677) (32768,72.8264) (65536,168.229) (131072,89.9657) (262144,57.0412) (524288,20.709) (1048576,13.6176) (2097152,4.38592) (4194304,2.34262) (8388608,1.28463) (16777216,1.07717) (33554432,1.06264) (67108864,1.10608) (1.34218e+08,1.16016) (2.68435e+08,1.22938) (5.36871e+08,1.28593) (1.07374e+09,1.33899) (2.14748e+09,1.44609) (4.29497e+09,1.48054) };
    \addlegendentry{\comppbalancedsort};
    \addplot coordinates { (8192,5.93031) (16384,3.85277) (32768,2.46876) (65536,1.8176) (131072,1.15574) (262144,0.885609) (524288,0.683664) (1048576,0.591716) (2097152,0.493099) (4194304,0.547112) (8388608,0.563306) (16777216,0.524339) (33554432,0.558912) (67108864,0.666277) (1.34218e+08,0.632071) (2.68435e+08,0.647687) (5.36871e+08,0.632246) (1.07374e+09,0.605324) (2.14748e+09,0.585763) };
    \addlegendentry{\radixppbbr};
    \addplot coordinates { (8192,195.39) (16384,87.215) (32768,38.0288) (65536,18.6988) (131072,9.13094) (262144,4.99075) (524288,2.86704) (1048576,1.70744) (2097152,1.19919) (4194304,0.810808) (8388608,0.627578) (16777216,0.520055) (33554432,0.479368) (67108864,0.4736) (1.34218e+08,0.502371) (2.68435e+08,0.487062) (5.36871e+08,0.50524) (1.07374e+09,0.467859) (2.14748e+09,0.442926) };
    \addlegendentry{\radixraduls};
    \addplot coordinates { (8192,29.3022) (16384,29.5039) (32768,73.6948) (65536,39.0266) (131072,19.9688) (262144,9.88199) (524288,4.9387) (1048576,2.55675) (2097152,1.3665) (4194304,0.910167) (8388608,0.611838) (16777216,0.490682) (33554432,0.617985) (67108864,0.545864) (1.34218e+08,0.528904) (2.68435e+08,0.512003) (5.36871e+08,0.503452) (1.07374e+09,0.493089) (2.14748e+09,0.47194) (4.29497e+09,0.454675) };
    \addlegendentry{\radixregion};
    \addplot+[on layer=foreground, mark layer=foreground] coordinates { (8192,4.74774) (16384,7.90842) (32768,13.4261) (65536,9.93803) (131072,2.36582) (262144,2.41156) (524288,0.806483) (1048576,0.477947) (2097152,0.411248) (4194304,0.37986) (8388608,0.377582) (16777216,0.36934) (33554432,0.371788) (67108864,0.405197) (1.34218e+08,0.486735) (2.68435e+08,0.48199) (5.36871e+08,0.46439) (1.07374e+09,0.455223) (2.14748e+09,0.436261) (4.29497e+09,0.419456) };
    \addlegendentry{\compiparassrsort};

      \legend{}
      
    % (Relative) Coordinate at top of the second plot
    \coordinate (c2) at (rel axis cs:1,1);
      
      \nextgroupplot[
      xlabel={Item count $n$},
      every axis y label/.append style={at=(ticklabel cs:1.1)},
      ylabel={Running time $t/ 8 n\log_2 n$},
      y unit=ns,
      title=\pcinteltwo]
    %% MULTIPLOT(algo|ptitle) select title as ptitle, size as x, 1000000.0 * milli * threads / (8 * size * log(2, size)) as y, MULTIPLOT
    %% from pavgnames
    %% where machine like 'i10pc132' and datatype like 'uint64' and size >= 2^13
    %% and algo not like 'ps4oparallel' and algo not like 'tbbparallelsort' and algo not like 'gnuparallel'
    %% order by titleorder, x
    \addplot+[on layer=foreground, mark layer=foreground] coordinates { (8192,25.4084) (16384,24.2976) (32768,22.4278) (65536,21.3273) (131072,12.5926) (262144,6.0945) (524288,5.32001) (1048576,2.89062) (2097152,1.71489) (4194304,1.11993) (8388608,0.884531) (16777216,0.742201) (33554432,0.6418) (67108864,0.581225) (1.34218e+08,0.548394) (2.68435e+08,0.525091) (5.36871e+08,0.506375) (1.07374e+09,0.499082) (2.14748e+09,0.482917) (4.29497e+09,0.476268) (8.58993e+09,0.47384) (1.71799e+10,0.476959) };
    \addlegendentry{\compiparassssort};
    \addplot coordinates { (8192,46.8749) (16384,21.1502) (32768,10.1287) (65536,5.58344) (131072,3.71409) (262144,2.93105) (524288,1.94029) (1048576,1.73572) (2097152,1.32606) (4194304,1.28544) (8388608,1.24943) (16777216,1.18535) (33554432,1.16125) (67108864,1.12743) (1.34218e+08,1.11973) (2.68435e+08,1.09923) (5.36871e+08,1.12622) (1.07374e+09,1.09564) (2.14748e+09,1.07855) (4.29497e+09,1.07189) (8.58993e+09,1.06305) (1.71799e+10,1.05425) };
    \addlegendentry{\compppbbs};
    \addplot coordinates { (8192,809.962) (16384,377.693) (32768,194.019) (65536,109.623) (131072,266.791) (262144,149.589) (524288,74.0144) (1048576,36.863) (2097152,16.4857) (4194304,6.06651) (8388608,3.94646) (16777216,2.08507) (33554432,1.59031) (67108864,1.40697) (1.34218e+08,1.30961) (2.68435e+08,1.26544) (5.36871e+08,1.23261) (1.07374e+09,1.31013) (2.14748e+09,1.27507) (4.29497e+09,1.25768) (8.58993e+09,1.25457) (1.71799e+10,1.32572) };
    \addlegendentry{\comppbalancedsort};
    \addplot coordinates { (8192,26.0697) (16384,16.8355) (32768,8.69438) (65536,5.85212) (131072,3.1308) (262144,2.62779) (524288,1.49794) (1048576,1.22113) (2097152,0.809273) (4194304,0.753866) (8388608,0.787527) (16777216,0.655455) (33554432,0.683064) (67108864,0.715723) (1.34218e+08,0.687151) (2.68435e+08,0.684219) (5.36871e+08,0.702349) (1.07374e+09,0.694161) (2.14748e+09,0.685463) (4.29497e+09,0.672939) (8.58993e+09,0.666009) (1.71799e+10,0.641826) };
    \addlegendentry{\radixppbbr};
    \addplot coordinates { (8192,2645.06) (16384,1227.98) (32768,581.772) (65536,271.002) (131072,128.867) (262144,61.3569) (524288,29.727) (1048576,14.4601) (2097152,7.28295) (4194304,4.1474) (8388608,2.25042) (16777216,1.29256) (33554432,0.822415) (67108864,0.61777) (1.34218e+08,0.515045) (2.68435e+08,0.470984) (5.36871e+08,0.43937) (1.07374e+09,0.40449) (2.14748e+09,0.371291) (4.29497e+09,0.371033) (8.58993e+09,0.379706) (1.71799e+10,0.388189) };
    \addlegendentry{\radixraduls};
    \addplot coordinates { (8192,177.15) (16384,184.622) (32768,414.695) (65536,226.606) (131072,115.728) (262144,57.6702) (524288,28.3663) (1048576,13.9168) (2097152,6.93938) (4194304,3.58016) (8388608,2.05628) (16777216,1.3475) (33554432,0.98566) (67108864,0.716136) (1.34218e+08,0.565491) (2.68435e+08,0.488552) (5.36871e+08,0.655353) (1.07374e+09,0.589949) (2.14748e+09,0.4657) (4.29497e+09,0.416) (8.58993e+09,0.422256) (1.71799e+10,0.456845) };
    \addlegendentry{\radixregion};
    \addplot+[on layer=foreground, mark layer=foreground] coordinates { (8192,44.5742) (16384,33.4266) (32768,29.3781) (65536,43.7594) (131072,20.7666) (262144,10.2545) (524288,4.98714) (1048576,2.63115) (2097152,1.56789) (4194304,1.02331) (8388608,0.830675) (16777216,0.665277) (33554432,0.5307) (67108864,0.476613) (1.34218e+08,0.470372) (2.68435e+08,0.453902) (5.36871e+08,0.442587) (1.07374e+09,0.445165) (2.14748e+09,0.461455) (4.29497e+09,0.445354) (8.58993e+09,0.420887) (1.71799e+10,0.402193) };
    \addlegendentry{\compiparassrsort};

      \legend{}

      \nextgroupplot[
      xlabel={Item count $n$},
      title=\pcintelfour,
      every legend/.append style={at=(ticklabel cs:1.1)},
      legend style={at={($(0,0)+(1cm,1cm)$)},legend columns=5,fill=none,draw=black,anchor=center,align=center},
      legend to name=legendplotp
      ]
    %% MULTIPLOT(algo|ptitle) select title as ptitle, size as x, 1000000.0 * milli * threads / (8 * size * log(2, size)) as y, MULTIPLOT
    %% from pavgnames
    %% where machine like 'i10pc136' and datatype like 'uint64' and size >= 2^13
    %% and algo not like 'ps4oparallel' and algo not like 'tbbparallelsort' and algo not like 'gnuparallel'
    %% order by titleorder, x
    \addplot+[on layer=foreground, mark layer=foreground] coordinates { (8192,36.044) (16384,32.4001) (32768,29.9261) (65536,26.1731) (131072,90.5515) (262144,48.1624) (524288,24.3135) (1048576,11.8765) (2097152,5.97586) (4194304,3.33518) (8388608,1.96277) (16777216,1.26028) (33554432,0.815912) (67108864,0.625805) (1.34218e+08,0.540967) (2.68435e+08,0.500081) (5.36871e+08,0.467528) (1.07374e+09,0.452329) (2.14748e+09,0.430276) (4.29497e+09,0.424179) (8.58993e+09,0.417892) (1.71799e+10,0.416613) };
    \addlegendentry{\compiparassssort};
    \addplot coordinates { (8192,67.4571) (16384,38.6036) (32768,19.0275) (65536,10.0741) (131072,6.91886) (262144,4.72144) (524288,3.24564) (1048576,2.48397) (2097152,2.43418) (4194304,1.73837) (8388608,1.48853) (16777216,1.25697) (33554432,1.05542) (67108864,0.952569) (1.34218e+08,0.907264) (2.68435e+08,0.868348) (5.36871e+08,0.856286) (1.07374e+09,0.833487) (2.14748e+09,0.83366) (4.29497e+09,0.827392) (8.58993e+09,0.824717) (1.71799e+10,0.827187) };
    \addlegendentry{\compppbbs};
    \addplot coordinates { (8192,2554.86) (16384,1190.3) (32768,538.14) (65536,259.738) (131072,125.98) (262144,408.964) (524288,218.289) (1048576,95.0953) (2097152,46.9502) (4194304,27.2228) (8388608,11.2783) (16777216,5.29861) (33554432,3.02936) (67108864,1.7904) (1.34218e+08,1.40502) (2.68435e+08,1.29377) (5.36871e+08,1.20868) (1.07374e+09,1.17937) (2.14748e+09,1.22924) (4.29497e+09,1.19382) (8.58993e+09,1.20298) (1.71799e+10,1.23756) };
    \addlegendentry{\comppbalancedsort};
    \addplot coordinates { (8192,52.9688) (16384,34.293) (32768,15.9934) (65536,9.42988) (131072,5.36045) (262144,5.80338) (524288,2.39102) (1048576,2.02866) (2097152,1.53177) (4194304,1.37644) (8388608,1.17545) (16777216,0.869737) (33554432,0.621215) (67108864,0.635606) (1.34218e+08,0.594969) (2.68435e+08,0.58366) (5.36871e+08,0.589864) (1.07374e+09,0.551571) (2.14748e+09,0.518685) (4.29497e+09,0.522189) (8.58993e+09,0.506355) (1.71799e+10,0.500243) };
    \addlegendentry{\radixppbbr};
    \addplot coordinates { (8192,6268.88) (16384,2890.54) (32768,1368.26) (65536,659.937) (131072,318.765) (262144,154.037) (524288,74.7112) (1048576,36.8155) (2097152,17.8391) (4194304,9.81669) (8388608,5.32285) (16777216,2.79481) (33554432,1.58304) (67108864,1.0004) (1.34218e+08,0.709608) (2.68435e+08,0.556756) (5.36871e+08,0.505768) (1.07374e+09,0.43976) (2.14748e+09,0.399433) (4.29497e+09,0.397535) (8.58993e+09,0.403518) (1.71799e+10,0.399576) };
    \addlegendentry{\radixraduls};
    \addplot coordinates { (8192,163.942) (16384,155.319) (32768,703.557) (65536,395.945) (131072,208.422) (262144,103.12) (524288,52.5127) (1048576,26.7517) (2097152,13.2696) (4194304,6.62146) (8388608,3.31544) (16777216,2.09448) (33554432,1.54502) (67108864,0.964909) (1.34218e+08,0.78287) (2.68435e+08,0.659037) (5.36871e+08,0.615859) (1.07374e+09,0.549614) (2.14748e+09,0.474463) (4.29497e+09,0.386302) (8.58993e+09,0.405818) (1.71799e+10,0.461207) };
    \addlegendentry{\radixregion};
    \addplot+[on layer=foreground, mark layer=foreground] coordinates { (8192,29.9185) (16384,28.3039) (32768,30.3215) (65536,22.5025) (131072,114.676) (262144,45.2224) (524288,23.1386) (1048576,11.7152) (2097152,5.60484) (4194304,3.19666) (8388608,1.89331) (16777216,1.24619) (33554432,0.706356) (67108864,0.516161) (1.34218e+08,0.49045) (2.68435e+08,0.448126) (5.36871e+08,0.443605) (1.07374e+09,0.440705) (2.14748e+09,0.438575) (4.29497e+09,0.407635) (8.58993e+09,0.383502) (1.71799e+10,0.386269) };
    \addlegendentry{\compiparassrsort};

    \end{groupplot}
    \coordinate (c3) at ($(c1)!.5!(c2)$);
    \node[below] at (c3 |- current bounding box.south)
    {\pgfplotslegendfromname{legendplotp}};
  \end{tikzpicture}
  \caption{
    Running times of parallel algorithms sorting \ulong values with input distribution \distuniform executed on different machines.
  }
  \label{fig:rt rand par}
\end{figure}
